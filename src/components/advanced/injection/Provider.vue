<template>
  <p>provider</p>
  <p>str in provider is : {{ refStr }}</p>
  <div>
    <MiddleComp></MiddleComp>
  </div>
</template>
<script setup lang="ts">
import { provide, readonly, ref } from "vue";
import MiddleComp from "./MiddleComp.vue";
// ğŸ’¡ä¾èµ–æ³¨å…¥éœ€æ±‚ï¼šè§£å†³æ·±å±‚ç»„ä»¶éœ€è¦è¾ƒé«˜å±‚çº§ç»„ä»¶çš„æ•°æ®é—®é¢˜ï¼Œï¼ˆä½ æ€»ä¸èƒ½é€çº§ä¼ é€’propä¸‹å»æŠŠï¼‰
// â—è§£å†³æ–¹æ¡ˆï¼šprovideæä¾›ã€injectæ³¨å…¥

// script setupä¸­ç›´æ¥ä½¿ç”¨ï¼Œâ—éè¯­æ³•ç³–åœºæ™¯ä¸‹ ç¡®ä¿åœ¨setup()ä¸­åŒæ­¥è°ƒç”¨
// ç¬¬ä¸€ä¸ªå‚æ•° é™¤äº†å­—ç¬¦ä¸²è¿˜å¯ä»¥æ˜¯Symbolâ—
provide(/* name */ "message", /* value */ "make people feel loved today~");

// â—ç›´æ¥åœ¨åº”ç”¨å±‚æä¾›ä¾èµ– å¯ä»¥åœ¨main.tsä¸­ç›´æ¥app.provide()

// å“åº”å¼æ•°æ®ç¤ºä¾‹ï¼š
const refStr = ref("default ref string");
// å“åº”å¼æ•°æ®ä¿®æ”¹
function changRefStr(newStr: string) {
  if (typeof newStr !== "string" || !newStr.trim()) {
    window.alert("invalid new string");
    refStr.value = "you stupid ";
    return;
  }
  console.log("valid new string : " + newStr);
  refStr.value = newStr;
}

provide("refStr", refStr);
provide("changeRefStr", changRefStr);

// readonly() åŒ…è£…å€¼ï¼Œç¡®ä¿ä¸ä¼šè¢«æ³¨å…¥æ–¹ä¿®æ”¹ï¼Œå¦‚ğŸ‘‡
const count = ref(0);
provide("count", readonly(count));

//â— å¤§å‹é¡¹ç›®å¯ä»¥ä½¿ç”¨symbolä½œä¸ºæ³¨å…¥keyé¿å…æ½œåœ¨å†²çª
</script>
